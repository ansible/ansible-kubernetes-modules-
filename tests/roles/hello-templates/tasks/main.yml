- name: Create project
  k8s:
    kubeconfig: '{{ os_kubeconfig }}'
    host: '{{ os_host }}'
    verify_ssl: '{{ os_verify_ssl }}'
    definition:
      kind: Project
      apiVersion: v1
      metadata:
        name: test-resource-defn
        displayName: Resource Defn
        description: Load resources
  register: create_project

- debug: msg={{ lookup('k8s', api_version='v1', kind='Project', resource_name="test-resource-defn")}}

# Create service from unaltered YAML copied from console
- name: Create service from resource definition
  k8s:
    state: present
    kubeconfig: '{{ os_kubeconfig }}'
    host: '{{ os_host }}'
    verify_ssl: '{{ os_verify_ssl }}'
    resource_definition:
      apiVersion: v1
      kind: Service
      metadata:
        name: hello-service
        namespace: test-resource-defn
      labels:
        app: hello
      spec:
        ports:
          - name: web-tcp
            protocol: TCP
            port: 8080
            targetPort: 8080
        selector:
          app: hello
        type: ClusterIP
        sessionAffinity: None
      status:
        loadBalancer: {}
  register: create_service

- debug: msg={{ lookup('k8s', api_version='v1', kind='Service', namespace='test-resource-defn', resource_name="hello-service") }}

- name: Create deployment from resource file
  k8s:
    state: present
    src: "{{ role_path }}/files/deployment.yml"
    kubeconfig: '{{ os_kubeconfig }}'
    host: '{{ os_host }}'
    verify_ssl: '{{ os_verify_ssl }}'
  register: deployment_create

- debug: msg={{ lookup('k8s', src=src) }}
  vars:
    src: "{{ role_path }}/files/deployment.yml"
